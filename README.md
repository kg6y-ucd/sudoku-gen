# sudoku-gen
A program that generates 9x9 or 16x16 Sudoku puzzles.

This program generates Sudoku puzzles with unique solutions.

Using the same generation logic as this program, we created data for TIC-80's [SUDOKU8000](https://tic80.com/play?cart=4203) and [SUDOKU16X16](https://tic80.com/play?cart=4263)
## Prerequisites
The prerequisites are as follows.
- JRE (Java Runtime Environment)
- alloy4.2_2015-02-22.jar downloaded from https://alloytools.org/download.html
- abcl.jar included in abcl-bin-1.9.2, which can be downloaded from https://armedbear.common-lisp.dev.

Place these two JAR files in the same directory as sudoku-gen.lisp.
## Program Execution Command
The following command generates 100 9x9 Sudoku puzzles. The results are output to a file named sudoku-gen-output-yyyy-mm-dd-hh-mi-ss.txt.
### Windows
```
java -cp alloy4.2_2015-02-22.jar;abcl.jar org.armedbear.lisp.Main --batch --load sudoku-gen.lisp --eval "(in-package :sudoku-gen)" --eval "(sudoku-gen 100)"
```
### Linux
```
java -cp alloy4.2_2015-02-22.jar:abcl.jar org.armedbear.lisp.Main --batch --load sudoku-gen.lisp --eval "(in-package :sudoku-gen)" --eval "(sudoku-gen 100)"
```
For 16x16, use the following command. The results are output to a file named sudoku-gen-16x16-output-yyyy-mm-dd-hh-mi-ss.txt.
### Windows
```
java -cp alloy4.2_2015-02-22.jar;abcl.jar org.armedbear.lisp.Main --batch --load sudoku-gen.lisp --eval "(in-package :sudoku-gen)" --eval "(sudoku-gen-16x16 100)"
```
### Linux
```
java -cp alloy4.2_2015-02-22.jar:abcl.jar org.armedbear.lisp.Main --batch --load sudoku-gen.lisp --eval "(in-package :sudoku-gen)" --eval "(sudoku-gen-16x16 100)"
```
## Notes
### Processing Overview
#### Method for Determining Solution Uniqueness
By repeatedly invoking the `*solution-generator*` generated by the `make-generator` function, one solution is produced at a time. If memory capacity allows, all solutions will be generated. Once all solutions have been generated, it returns `nil`. Therefore, whether a board with some cells left blank from a given solution has a unique solution can be determined by the second invocation of the function generated by `make-generator` returning `nil`.
#### Thread Configuration for Multi-Core Utilization to Reduce Processing Time
The main thread generates a number of worker threads equal to the number of cores. It then creates a specified number of base solutions for puzzles (e.g., 100) and distributes them to the worker threads via a FIFO queue. Each worker thread retrieves a base solution from the queue, generates a puzzle, and outputs it in string format (81 characters for 9x9, 256 characters for 16x16). When generating puzzles, worker threads iterate to maximize the number of blank cells based on the specified parameters.

There are three parameters: `*easy*`, `*threshold*`, and `*n*`. `*easy*` determines whether only simple puzzles are generated, while `*threshold*` and `*n*` are used when selecting blank cells randomly. For more details, refer to the comments in the source code.

When modifying these parameters in 16x16 mode, please adjust the let bindings inside `make-sudoku-16x16`.
### performance
The generation time when executed on the N100 mini PC is as follows.
#### 9x9
```
SUDOKU-GEN> (time (sudoku-gen 100))
puzzle=1 q=0 WWWW repl-thread enqueue No.1
...
puzzle=100 q=0 TTTT interpreter join worker04
117.978 seconds real time
```
#### 16x16
For 16x16 puzzles, the initial invocation of `*solution-generator*` takes a long time. However, repeated invocations reduce the processing time, leading to a faster generation pace as more solutions are created.

Initial Invocation with `*solution-senerator*` Creation
```
SUDOKU-GEN> (time (sudoku-gen-16x16 10))
puzzle=1 q=0 WWWW repl-thread enqueue No.1
...
puzzle=10 q=0 TTTT repl-thread join worker04
3621.618 seconds real time
```
Second Invocation Utilizing an Already Generated `*solution-generator*`
```
SUDOKU-GEN> (time (sudoku-gen-16x16 10))
puzzle=1 q=0 WWWW repl-thread enqueue No.1
...
puzzle=10 q=0 TTTT repl-thread join worker04
1098.956 seconds real time
```
Third Invocation Utilizing an Already Generated `*solution-generator*`
```
SUDOKU-GEN> (time (sudoku-gen-16x16 10))
puzzle=1 q=0 WWWW repl-thread enqueue No.1
puzzle=10 q=0 TTTT repl-thread join worker04
1055.318 seconds real time
```
### error-output format
`*error-output*` logs the processing status in the following format. The first field represents the puzzle number being processed, the second field indicates the queue length, the third field is a string representing the state of each worker thread using a single character (W = WAITING, R = RUNNABLE, B = BLOCKED, T = TERMINATED), the fourth field is the thread name, and the remaining fields contain the messages output by that thread.

The following is an example of execution on a 4-core machine, where the third field is a four-character string.
```
puzzle=1 q=0 WWWW interpreter enqueue No.1
puzzle=2 q=0 RWWW interpreter enqueue No.2
puzzle=3 q=0 RWRW interpreter enqueue No.3
...
puzzle=99 q=8 RRRR interpreter enqueue No.99
puzzle=100 q=8 RRRR interpreter enqueue No.100
puzzle=100 q=3 RRRR worker02 finish
puzzle=100 q=2 RTRR worker01 finish
puzzle=100 q=2 TTRR interpreter join worker01
puzzle=100 q=2 TTRR interpreter join worker02
puzzle=100 q=1 TTRR worker04 finish
puzzle=100 q=0 TTRT worker03 finish
puzzle=100 q=0 TTTT interpreter join worker03
puzzle=100 q=0 TTTT interpreter join worker04
```
